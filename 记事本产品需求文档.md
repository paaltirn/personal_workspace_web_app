

### **AI-Native Notes App: Product & Technical Specification**

#### **1. 项目/功能概述 (Overview)**

创建一个专为个人桌面端（MacBook）设计的、具有苹果设计风格的笔记 Web 应用。该应用的核心特色是集成了 AI 功能（自动生成标题、标签和内容润色），并且为了简化开发，所有笔记数据将直接存储在用户的浏览器本地 (`localStorage`)。

#### **2. 核心功能点 (Core Features)**

*   **三栏式布局:** 界面分为固定的侧边栏、笔记列表栏和主编辑区。
*   **笔记管理:** 用户可以创建、编辑和删除笔记。
*   **Markdown 编辑器:** 支持 Markdown 语法，提供富文本写作体验。
*   **笔记列表:** 在中间栏清晰地展示所有笔记的标题。
*   **本地存储:** 所有笔记数据持久化在浏览器中，无需后端服务器或数据库。
*   **AI 功能 - 生成标题:** 提供一个按钮，点击后调用 AI 分析笔记内容并生成一个合适的标题。
*   **AI 功能 - 自动标签:** 当用户完成编辑时，系统自动调用 AI 分析内容，生成并展示相关标签。
*   **AI 功能 - 内容润色:** 提供一个按钮，点击后 AI 会对全文进行润色。润色结果将与原文并排展示，供用户选择是否接受。

#### **3. 技术规格 (Technical Specifications)**

##### **前端 (Frontend)**

*   **页面/组件 (Pages/Components):**
    *   **`AppLayout.jsx`**: 整体三栏布局的容器组件。
    *   **`Sidebar.jsx`**: 最左侧的图标栏（可先留空或只放一个“笔记”图标）。
    *   **`NoteList.jsx`**: 中间栏，负责获取所有笔记并渲染 `NoteListItem` 列表。包含一个“新建笔记”按钮。
    *   **`NoteListItem.jsx`**: 笔记列表中的单个项目，只显示标题，并处理点击和选中状态。
    *   **`Editor.jsx`**: 右侧主编辑区，包含：
        *   标题输入框 (`<input>`)。
        *   Markdown 内容输入区 (`<textarea>`)。
        *   AI 功能按钮 (“生成标题”, “润色全文”)。
        *   标签展示区 (在标题下方)。
    *   **`PolishModal.jsx`**: 一个弹窗组件，用于并排（Side-by-Side）展示原文和 AI 润色后的版本，包含“接受”和“取消”按钮。
    *   **`Settings.jsx` (推荐):** 一个简单的页面或弹窗，用于让用户输入并保存他们的 OpenRouter API 密钥到 `localStorage`，避免将密钥硬编码在代码中。

*   **用户流程 (User Flow):**
    1.  **启动应用:** 用户打开网页。应用从 `localStorage` 读取所有笔记数据。
    2.  **查看列表:** 笔记标题列表展示在中间栏。
    3.  **新建笔记:** 用户点击“新建笔记”按钮，一个新的空笔记被创建、保存到 `localStorage`，并在列表中高亮显示，同时编辑器切换到这个新笔记。
    4.  **编辑笔记:** 用户点击一个笔记标题，其内容加载到右侧编辑器中。用户在标题或内容区输入文字。
    5.  **自动保存:** 在用户停止输入片刻后（使用 debounce 技术），应用自动将更改保存到 `localStorage`。
    6.  **触发 AI:**
        *   **生成标题:** 用户点击“生成标题”按钮，应用将当前笔记内容发送给 OpenRouter AI，并将返回的标题填入标题框。
        *   **自动标签:** 在笔记内容自动保存后，应用将内容发送给 OpenRouter AI，并将返回的标签（如 `['AI', '开发', '笔记']`）更新并显示。
        *   **润色:** 用户点击“润色全文”按钮，应用将内容发送给 OpenRouter AI，然后弹出 `PolishModal` 展示对比结果。用户点击“接受”后，编辑器中的内容被替换。

*   **数据交互 (Data Interaction):**
    *   **对内 (Local Storage):**
        *   `localStorage.getItem('notes')`: 读取所有笔记数据（一个 JSON 字符串）。
        *   `localStorage.setItem('notes', newNotesArray)`: 写入/更新所有笔记数据。
        *   `localStorage.setItem('apiKey', 'sk-or-...')`: (推荐) 保存用户的 API 密钥。
    *   **对外 (AI Service Calls):** 所有对 AI 的请求都直接从前端发起。

##### **后端 (Backend) - AI 服务调用**

*由于选择本地存储，我们不需要自建后端服务。* 此处定义的是对外部 AI 服务的调用规则。

*   **API 接口 (API Endpoints):**
    *   **Endpoint:** `POST https://openrouter.ai/api/v1/chat/completions`
    *   **Headers:**
        *   `Authorization: Bearer YOUR_OPENROUTER_API_KEY` (此密钥应从 `localStorage` 读取)
        *   `Content-Type: application/json`
    *   **请求体 (Request Body) 示例:**
        *   **生成标题:**
            ```json
            {
              "model": "deepseek/deepseek-chat-v3.1",
              "messages": [
                {"role": "user", "content": "根据以下文本，生成一个简洁的标题（10个词以内），只返回标题本身。文本：\n\n[这里是用户的笔记内容]"}
              ]
            }
            ```
        *   **生成标签:**
            ```json
            {
              "model": "deepseek/deepseek-chat-v3.1",
              "messages": [
                {"role": "user", "content": "根据以下文本，生成最多5个相关的标签。请以逗号分隔的格式返回，例如：技术,AI,编程。文本：\n\n[这里是用户的笔记内容]"}
              ]
            }
            ```
        *   **内容润色:**
            ```json
            {
              "model": "deepseek/deepseek-chat-v3.1",
              "messages": [
                {"role": "user", "content": "请扮演一个专业的编辑，润色以下文本，使其更清晰、流畅、专业，但保持原意。只返回润色后的文本。文本：\n\n[这里是用户的笔记内容]"}
              ]
            }
            ```

*   **数据模型 (Data Models - 用于 Local Storage):**
    我们将使用一个 `Note` 对象数组来存储所有数据。单个 `Note` 对象的结构如下：
    ```typescript
    interface Note {
      id: string; // 唯一标识符，例如 '1700000000000' 或 UUID
      title: string;
      content: string; // Markdown 格式的纯文本
      tags: string[]; // 例如 ['AI', 'Productivity']
      createdAt: string; // ISO 8601 格式的日期字符串
      updatedAt: string; // ISO 8601 格式的日期字符串
    }
    ```

#### **4. 技术栈建议 (Tech Stack Suggestion)**

*   **框架 (Framework):** **Next.js**。虽然它通常用于复杂的应用，但它的“静态导出”功能 (`output: 'export'`) 非常适合构建这种无后端的纯前端应用，同时能享受其优秀的文件路由和开发体验。
*   **UI 组件库:** **Shadcn/UI** (基于你的要求) 和 **Tailwind CSS** (Shadcn/UI 的基础)。
*   **状态管理 (State Management):** 使用 React 的内置 Hooks (`useState`, `useEffect`, `useContext`) 配合一个自定义的 `useLocalStorage` Hook 来管理笔记数据，完全足够。
*   **Markdown 渲染:** 使用 `react-markdown` 库将 Markdown 文本渲染为 HTML。
*   **唯一 ID 生成:** 使用 `uuid` 库来为每个新笔记生成唯一的 `id`。

#### **5. 开发步骤建议 (Development Steps)**

我为你把整个项目拆解成了可以一步步完成的小任务清单：

1.  **环境搭建:**
    *   使用 `npx create-next-app@latest` 初始化一个新的 Next.js 项目。
    *   按照 `shadcn/ui` 的官方文档，将其集成到你的项目中。

2.  **静态布局:**
    *   创建 `AppLayout.jsx` 组件，用 CSS Grid 或 Flexbox 实现三栏布局。
    *   创建 `Sidebar.jsx`, `NoteList.jsx`, `Editor.jsx` 的骨架，并放置在布局中。

3.  **本地数据核心:**
    *   创建一个自定义 Hook `useNotes.js`，内部使用 `useState` 和 `useEffect` 来实现从 `localStorage` 读取和写入笔记数组。这个 Hook 将提供 `notes`, `addNote`, `updateNote`, `deleteNote` 等函数。

4.  **实现笔记列表与编辑器:**
    *   在 `NoteList.jsx` 中，使用 `useNotes` Hook 获取笔记列表并循环渲染 `NoteListItem`。
    *   实现点击 `NoteListItem` 时，通知父组件更新“当前选中笔记 ID”的状态。
    *   `Editor.jsx` 根据“当前选中笔记 ID”从 `useNotes` Hook 中找到对应笔记并显示其 `title` 和 `content`。

5.  **实现核心编辑功能:**
    *   为 `Editor.jsx` 中的输入框和文本域添加 `onChange` 事件，当用户输入时，调用 `useNotes` 的 `updateNote` 函数。
    *   **进阶:** 使用 `debounce` 函数包裹 `updateNote`，避免用户每输入一个字符就频繁写入 `localStorage`。

6.  **集成 AI - 生成标题:**
    *   在 `Editor.jsx` 中添加“生成标题”按钮。
    *   编写一个 `api.js` 文件，封装调用 OpenRouter 的 `fetch` 请求。
    *   按钮点击时，调用该请求，并将返回结果更新到当前笔记的 `title` 状态中。
    *   **重要:** 在此之前，先做一个简单的设置页面，让你可以输入 API Key 并保存在 `localStorage`，然后在 `api.js` 中读取它。

7.  **集成 AI - 自动标签:**
    *   在 `useNotes` Hook 的 `updateNote` 函数成功执行后，触发调用 AI 生成标签的请求。
    *   获取到标签后，再次调用 `updateNote` 将标签存入对应的笔记对象。

8.  **集成 AI - 内容润色:**
    *   创建 `PolishModal.jsx` 组件。
    *   在 `Editor.jsx` 中添加“润色”按钮，点击后调用 AI 润色接口。
    *   获取到润色后的文本后，将原文和新文本传入 `PolishModal` 并显示它。
    *   根据用户在 Modal 中的操作（接受/取消）来决定是否更新笔记内容。

9.  **完善与美化:**
    *   使用 `shadcn/ui` 提供的 `Button`, `Input`, `Textarea`, `Card` 等组件替换原生的 HTML 元素。
    *   使用 Tailwind CSS 调整间距、颜色、字体，达到你想要的苹果风格。
    *   处理空状态（没有笔记时显示什么）和加载状态（AI 调用时显示加载动画）。